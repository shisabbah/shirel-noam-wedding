<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shirel & Noam - Invitation Mariage</title>
    <!-- Open Graph / Social preview -->
    <meta property="og:title" content="Invitation mariage Shirel & Noam" />
    <meta property="og:description" content="Vous êtes invité au mariage de Shirel et Noam le 25 février." />
    <meta property="og:image" content="https://shisabbah.github.io/shirel-noam-wedding/logo.png" />
    <meta property="og:url" content="https://shisabbah.github.io/shirel-noam-wedding/" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="fr_FR" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Invitation mariage Shirel & Noam" />
    <meta name="twitter:description" content="Vous êtes invité au mariage de Shirel et Noam le 25 février." />
    <meta name="twitter:image" content="https://shisabbah.github.io/shirel-noam-wedding/logo.png" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="first-page" id="firstPage">
        <img src="new-accueil.png" alt="Accueil" class="fullscreen-image clickable" id="part1">
    </div>
    <div class="scroll-container hidden" id="scrollContainer">
        <button class="nav-button nav-prev" id="prevPage" aria-label="Page précédente">‹</button>
        <div class="image-wrapper">
            <img src="mairie.png" alt="Mairie" class="scroll-image active">
            <img src="henne.png" alt="Henne" class="scroll-image">
            <img src="houppa.png" alt="Houppa" class="scroll-image">
            <div class="scroll-image form-container" style="background-image: url('form.png'); background-size: contain; background-position: center; background-repeat: no-repeat;">
                <form class="wedding-form" id="weddingForm">
                    <h2 class="form-title">Répondez à l'invitation</h2>
                    
                    <div class="form-group">
                        <label for="prenom">Prénom</label>
                        <input type="text" id="prenom" name="prenom" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="nom">Nom</label>
                        <input type="text" id="nom" name="nom" required>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <div class="checkboxes">
                            <div class="event-item">
                                <label for="nb_mairie" class="event-title">Mairie</label>
                                <input type="number" name="nb_mairie" id="nb_mairie" min="0" value="0" class="event-number">
                            </div>
                            <div class="event-item">
                                <label for="nb_henne" class="event-title">Henné</label>
                                <input type="number" name="nb_henne" id="nb_henne" min="0" value="0" class="event-number">
                            </div>
                            <div class="event-item">
                                <label for="nb_mariage" class="event-title">Mariage</label>
                                <input type="number" name="nb_mariage" id="nb_mariage" min="0" value="0" class="event-number">
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="submit-btn">Envoyer</button>
                </form>
            </div>
        </div>
        <button class="nav-button nav-next" id="nextPage" aria-label="Page suivante">›</button>
        <div class="page-indicator" id="pageIndicator">1 / 4</div>
    </div>
    <script>
        const part1 = document.getElementById('part1');
        const firstPage = document.getElementById('firstPage');
        const scrollContainer = document.getElementById('scrollContainer');
        const scrollImages = Array.from(document.querySelectorAll('.scroll-image'));
        const prevPageBtn = document.getElementById('prevPage');
        const nextPageBtn = document.getElementById('nextPage');
        const pageIndicator = document.getElementById('pageIndicator');
        let currentIndex = 0;

        part1.addEventListener('click', function() {
            firstPage.style.opacity = '0';
            firstPage.style.transform = 'scale(0.95)';
            setTimeout(() => {
                firstPage.classList.add('hidden');
                scrollContainer.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }, 300);
        });

        function updatePages(direction) {
            scrollImages.forEach((img, index) => {
                img.classList.remove('active', 'from-left', 'from-right');
                if (index === currentIndex) {
                    img.classList.add('active');
                    if (direction === 'next') img.classList.add('from-right');
                    if (direction === 'prev') img.classList.add('from-left');
                }
            });
            if (pageIndicator) {
                pageIndicator.textContent = (currentIndex + 1) + ' / ' + scrollImages.length;
            }
            if (prevPageBtn && nextPageBtn) {
                prevPageBtn.disabled = currentIndex === 0;
                nextPageBtn.disabled = currentIndex === scrollImages.length - 1;
            }
        }

        if (prevPageBtn && nextPageBtn) {
            prevPageBtn.addEventListener('click', function () {
                if (currentIndex > 0) {
                    currentIndex--;
                    updatePages('prev');
                }
            });

            nextPageBtn.addEventListener('click', function () {
                if (currentIndex < scrollImages.length - 1) {
                    currentIndex++;
                    updatePages('next');
                }
            });
        }

        // Navigation clavier (flèches)
        document.addEventListener('keydown', function (e) {
            if (scrollContainer.classList.contains('hidden')) return;
            if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                if (currentIndex < scrollImages.length - 1) {
                    currentIndex++;
                    updatePages('next');
                }
            } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                if (currentIndex > 0) {
                    currentIndex--;
                    updatePages('prev');
                }
            }
        });

        // Initialisation
        updatePages();

        // Gestion du formulaire
        const weddingForm = document.getElementById('weddingForm');
        if (weddingForm) {
            const nbMairie = document.getElementById('nb_mairie');
            const nbHenne = document.getElementById('nb_henne');
            const nbMariage = document.getElementById('nb_mariage');
            
            weddingForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                const data = new FormData(weddingForm);
                const obj = {};
                data.forEach((value, key) => obj[key] = value);

                // Désactiver le bouton pendant l'envoi
                const submitBtn = weddingForm.querySelector('.submit-btn');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'Envoi en cours...';
                
                try {
                    // URL du script Google Apps Script
                    const scriptUrl = 'https://script.google.com/macros/s/AKfycbydj05h9Gf7ngokwVnlgSbFeuL8CL-vvuvkROSBsegLHyqduAMFxjOExfWK6-hO7X9EYw/exec';
                    
                    // Envoyer les données au script Google Apps Script
                    const response = await fetch(scriptUrl, {
                        method: 'POST',
                        mode: 'no-cors', // Google Apps Script nécessite no-cors pour les requêtes publiques
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: new URLSearchParams(obj)
                    });
                    
                    // Note: Avec mode 'no-cors', on ne peut pas lire la réponse HTTP
                    // Mais si la requête est envoyée sans erreur, on considère que c'est un succès
                    // Le script Google Apps Script enregistrera les données dans Sheets
                    
                    // Attendre un court délai pour laisser le temps au script de traiter
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Afficher le message de succès
                    alert('Merci ! Votre réponse a été enregistrée avec succès.');
                    weddingForm.reset();
                    // Réinitialiser les valeurs à 0
                    if (nbMairie) nbMairie.value = 0;
                    if (nbHenne) nbHenne.value = 0;
                    if (nbMariage) nbMariage.value = 0;
                } catch (err) {
                    // En cas d'erreur réseau ou autre
                    console.error('Erreur lors de l\'envoi:', err);
                    alert('Erreur : Impossible d\'envoyer les données. Veuillez vérifier votre connexion internet et réessayer.\n\nSi le problème persiste, vérifiez la configuration du script Google Apps Script.');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            });
        }
    </script>
</body>
</html>
